<!DOCTYPE html>
<html lang="en" data-capable="pwa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5" />
<meta name="theme-color" content="#000000" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<title>Media Tools By PirateRuler.com ‚Äî Modern Media Suite</title>
<meta name="description" content="Media Tools By PirateRuler.com ‚Äî modern suite of 10+ media tools: audio editor, video converter, image filters, webcam capture & more. Private and fast." />
<meta property="og:title" content="Media Tools by PirateRuler.com" />
<meta property="og:description" content="Professional all-in-one media tools suite. Private, fast, and works offline. 10+ tools for audio, video, and image editing." />
<meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect width='400' height='400' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' font-family='Inter' font-weight='800' font-size='200' text-anchor='middle' dominant-baseline='middle' fill='white'%3EPR%3C/text%3E%3C/svg%3E" />
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect rx='14' width='64' height='64' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' font-family='Inter,Arial,sans-serif' font-weight='800' font-size='26' text-anchor='middle' alignment-baseline='central' fill='white'%3EPR%3C/text%3E%3C/svg%3E">
<link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk1lZGlhIFRvb2xzIEJ5IFBpcmF0ZVJ1bGVyIiwKICAic2hvcnRfbmFtZSI6ICJQaXJhdGVSdWxlciBNZWRpYSIsCiAgInN0YXJ0X3VybCI6ICIvaW5kZXguaHRtbCIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZhZmFmYSIsCiAgInRoZW1lX2NvbG9yIjogIiMwMDAwMDAiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7aGFzaGVuNjQsUEhOMGNtOXphVzl1SUdSdmJXRnBiaUJwZEhsd1pTOHdMeUEyTUNrZ2VHMHBPeUJ6ZEhKdmJtY2dMUzR1TGk0Z1RXVnlkbWx5YVM0eU1qQXhNVGc0T0RnNExqY3VNakV3TVRnNE9EZzRMak11TlRBd0xqWTBJRlJqWTJWeWRXWTJZR0poTFRRdU9USTVOemMyT0RNdU5qSTVOemMyT0RNdU9DNDFNRFV3TGpZMUlGSmhZM05sZEc5dFlYUnBZMnNnTUM0eE1EQXNOekF1TmpZZ2VHOXpkRnhtYVd3aUlpQmxibTVsYzE5dFBTSWpSa1pCU1VaR0lEUWdOakV3TVNBMUlEVWdOalV3TVNCR0lEUXhJRVF3SWlCMGFHVnVDbUZtZEdWeVBTSmxjMk55YVhCMApJaTgrIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJzaXplcyI6ICI2NHg2NCIKICAgIH0KICBdCn0K">
<style>
  :root{
    --bg:#fafafa; --card:#ffffff; --muted:#6b7280; --text:#111827;
    --border:#e5e7eb; --accent:#000000; --key-bg:#f3f4f6;
    --success:#10b981; --warning:#f59e0b; --error:#ef4444;
    --shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);
    --shadow-md:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
    --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
    --radius-sm:4px; --radius-md:6px; --radius-lg:8px; --radius-xl:12px;
    --transition:all 0.2s cubic-bezier(0.4,0,0.2,1);
  }
  html.dark {
    --bg:#111827; --card:#1f2937; --muted:#9ca3af; --text:#f9fafb;
    --border:#374151; --accent:#ffffff; --key-bg:#374151;
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
  html{scroll-behavior:smooth;}
  body{background:var(--bg); font-family:'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial; color:var(--text); margin:0; transition:var(--transition);}
  .container{max-width:1400px;margin:0 auto;padding:20px;}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
  header.header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 24px; border-radius:var(--radius-xl); background:var(--card); box-shadow:var(--shadow-md); margin-bottom:20px; position:sticky; top:20px; z-index:100; border:1px solid var(--border);}
  .brand{display:flex; align-items:center; gap:12px;}
  .logo{width:48px;height:48px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-weight:800; background:var(--accent); color:var(--bg); font-size:18px; flex-shrink:0; transition:var(--transition);}
  .logo:hover{transform:scale(1.05) rotate(5deg);}
  .brand-title .title-strong{font-size:24px;font-weight:800;margin:0; letter-spacing:-0.5px; color:var(--accent);}
  .brand-title .by{font-size:13px;color:var(--muted); margin-top:2px}
  .header-actions{display:flex; gap:12px; align-items:center;}
  .theme-toggle{width:52px;height:26px;border-radius:13px;background:var(--border);position:relative;cursor:pointer;transition:var(--transition);padding:2px;}
  .theme-toggle.active{background:var(--accent);}
  .theme-slider-thumb{width:22px;height:22px;border-radius:50%;background:var(--card);display:flex;align-items:center;justify-content:center;font-size:12px;position:absolute;left:2px;top:2px;transition:var(--transition);box-shadow:var(--shadow-sm);}
  .theme-toggle.active .theme-slider-thumb{transform:translateX(26px);}
  .btn{padding:10px 16px; border-radius:var(--radius-md); border:1px solid var(--border); cursor:pointer; font-weight:600; background:var(--bg); color:var(--text); transition:var(--transition); box-shadow:var(--shadow-sm); text-decoration:none;}
  .btn:hover{background:var(--accent); color:var(--bg); transform:translateY(-2px); box-shadow:var(--shadow-md);}
  .hamb{width:44px;height:44px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid var(--border);font-weight:bold;background:var(--bg);transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .hamb:hover{background:var(--accent);color:var(--bg);transform:translateY(-2px) rotate(90deg);box-shadow:var(--shadow-md);}
  .hero{padding:48px 24px;border-radius:var(--radius-xl);background:var(--card);box-shadow:var(--shadow-lg);margin-bottom:24px;}
  @media(min-width:1100px){.hero{padding:56px 48px;}}
  .hero .big{font-size:40px;font-weight:800;margin:0;text-align:center;letter-spacing:-1px;}
  .hero .small{text-align:center;color:var(--muted);margin-top:12px;max-width:960px;margin-left:auto;margin-right:auto;line-height:1.6;}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:28px;}
  .tab{padding:10px 18px;border-radius:var(--radius-md);border:1px solid var(--border);cursor:pointer;color:var(--muted);font-weight:600;background:var(--bg);transition:var(--transition);box-shadow:var(--shadow-sm);}
  .tab:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);color:var(--text);}
  .tab.active{background:var(--accent);color:var(--bg);font-weight:700;border-color:var(--accent);box-shadow:var(--shadow-md);}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:24px;margin-top:20px;align-items:start;}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:var(--radius-xl);border:1px solid var(--border);padding:28px;animation:cardIn .42s both;box-shadow:var(--shadow-md);}
  .card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);}
  @keyframes cardIn{from{transform:translateY(12px) scale(0.98);opacity:0}to{transform:none;opacity:1}}
  .card h2{margin:0 0 12px 0;font-size:22px;font-weight:800;letter-spacing:-0.5px;display:flex;align-items:center;gap:8px;}
  .hint{color:var(--muted);font-size:14px;margin-bottom:16px;line-height:1.5;}
  input[type="text"],input[type="number"],input[type="date"],input[type="color"],input[type="range"],select,textarea{width:100%;padding:14px;border-radius:var(--radius-md);border:1px solid var(--border);font-size:15px;background:var(--bg);color:var(--text);transition:var(--transition);box-shadow:var(--shadow-sm);font-family:inherit;}
  input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,0,0,0.05);}
  .dark input:focus,.dark select:focus,.dark textarea:focus{box-shadow:0 0 0 3px rgba(255,255,255,0.1);}
  .row{display:flex;gap:12px;flex-wrap:wrap;}
  .row>*{flex:1;min-width:120px;}
  .primary{background:var(--accent);color:var(--bg);padding:10px 16px;border-radius:var(--radius-md);border:1px solid var(--accent);font-weight:700;cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
  .ghost{background:var(--bg);color:var(--text);border:1px solid var(--border);padding:10px 14px;border-radius:var(--radius-md);cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .ghost:hover{background:var(--accent);color:var(--bg);transform:translateY(-2px);box-shadow:var(--shadow-md);}
  .result{margin-top:16px;font-weight:700;color:var(--text);border-top:1px solid var(--border);padding-top:14px;font-size:16px;min-height:24px;display:flex;align-items:center;gap:8px;}
  .result .icon{font-size:18px;}
  .result.success{color:var(--success);}
  .result.warning{color:var(--warning);}
  .result.error{color:var(--error);}
  .key-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:16px;}
  .key{padding:18px;border-radius:var(--radius-sm);border:1px solid var(--border);font-weight:600;cursor:pointer;text-align:center;background:var(--key-bg);color:var(--text);transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .key:hover{background:var(--accent);color:var(--bg);transform:translateY(-3px);box-shadow:var(--shadow-md);}
  .key:active{transform:translateY(0);}
  .key-grid-3{grid-template-columns:repeat(3,1fr);}
  .key-grid-2{grid-template-columns:repeat(2,1fr);}
  .display{font-size:24px;font-weight:700;background:var(--bg);padding:14px;border-radius:var(--radius-md);border:1px solid var(--border);margin-bottom:12px;text-align:center;font-family:'Courier New', monospace;}
  aside{align-self:start;position:relative;}
  .feature-panel{background:var(--card);border-radius:var(--radius-xl);border:1px solid var(--border);padding:24px;box-shadow:var(--shadow-md);}
  @media(min-width:981px){.feature-panel{position:sticky;top:20px;max-height:calc(100vh - 40px);overflow:auto;}}
  .panel-title{font-weight:800;margin:6px 6px 14px 6px;font-size:20px;letter-spacing:-0.5px;display:flex;align-items:center;gap:8px;}
  .features{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  @media(max-width:700px){.features{grid-template-columns:1fr;}}
  .feature{display:flex;gap:14px;align-items:center;padding:18px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--card);min-height:110px;transition:var(--transition);}
  .feature:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);}
  .f-icon{width:48px;height:48px;border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--bg);background:var(--accent);flex-shrink:0;font-size:18px;}
  .f-title{font-weight:700;margin-bottom:4px;}
  .f-desc{color:var(--muted);font-size:13px;line-height:1.5;}
  .useful-tips{margin-top:20px;padding:18px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--bg);}
  .useful-tips h3{margin:0 0 12px 0;font-weight:800;font-size:16px;display:flex;align-items:center;gap:8px;}
  .useful-tips ul{margin:0;padding-left:20px;}
  .useful-tips li{margin:8px 0;color:var(--muted);font-size:14px;line-height:1.5;}
  .useful-tips li strong{color:var(--text);}
  footer{margin-top:24px;padding:24px;border-radius:var(--radius-xl);background:var(--card);border:1px solid var(--border);text-align:center;box-shadow:var(--shadow-md);}
  .visit{padding:12px 24px;border-radius:var(--radius-md);display:inline-block;background:var(--accent);color:var(--bg);font-weight:800;text-decoration:none;transition:var(--transition);box-shadow:var(--shadow-sm);}
  .visit:hover{transform:translateY(-3px) scale(1.02);box-shadow:var(--shadow-lg);}
  .muted{color:var(--muted);font-size:14px;line-height:1.5;}
  .spacer{height:10px}
  .sidebar{position:fixed;top:0;right:0;height:100vh;width:380px;max-width:94vw;transform:translateX(120%);transition:transform .28s cubic-bezier(.2,.9,.3,1);z-index:1000;background:var(--card);border-left:1px solid var(--border);padding:24px;overflow:auto;box-shadow:var(--shadow-lg);}
  .sidebar.open{transform:translateX(0);}
  .close{display:flex;justify-content:flex-end;}
  .nav-list{margin-top:16px;display:flex;flex-direction:column;gap:8px}
  .nav-list a{display:block;padding:14px;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--bg);color:var(--text);font-weight:600;transition:var(--transition);box-shadow:var(--shadow-sm); text-decoration:none;}
  .nav-list a:hover{background:var(--accent);color:var(--bg);transform:translateX(-6px);box-shadow:var(--shadow-md);}
  .backup{margin-top:18px;color:var(--muted);font-size:13px;border-top:1px solid var(--border);padding-top:12px;line-height:1.5;}
  .toast{position:fixed;bottom:24px;right:24px;padding:16px 20px;border-radius:var(--radius-lg);background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow-lg);transform:translateY(120px);transition:transform .3s cubic-bezier(.2,.9,.3,1);z-index:1001;font-weight:600;display:flex;align-items:center;gap:10px;max-width:320px;}
  .toast.show{transform:translateY(0);}
  .toast .icon{font-size:20px;}
  @media(max-width:480px){.hero .big{font-size:28px;}.container{padding:12px;}.header{top:12px;padding:12px 16px;}.grid{gap:16px;}.card{padding:20px;}}
  ::-webkit-scrollbar{width:8px;height:8px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px;}::-webkit-scrollbar-thumb:hover{background:var(--muted);}
  textarea{resize:vertical;min-height:100px;}
  .canvas-preview{max-width:100%;border-radius:var(--radius-md);border:1px solid var(--border);margin-top:12px;}
  video{max-width:100%;border-radius:var(--radius-md);border:1px solid var(--border);}
  .brand a{text-decoration:none;}
</style>
</head>
<body>
<div class="container">
  <a href="#main-content" class="sr-only">Skip to main content</a>
  <header class="header" role="banner">
    <div class="brand">
      <a href="index.html" aria-label="Home" style="display:flex;align-items:center;gap:12px">
        <div class="logo" aria-hidden="true">PR</div>
        <div class="brand-title">
          <div class="title-strong">Media Tools</div>
          <div class="by">by PirateRuler.com</div>
        </div>
      </a>
    </div>
    <div class="header-actions">
      <div class="theme-toggle" id="themeBtn" title="Toggle dark mode" aria-label="Toggle dark mode">
        <div class="theme-slider-thumb">üåô</div>
      </div>
      <div class="hamb" id="hambBtn" title="Open menu" aria-haspopup="true" aria-controls="sidebar">‚ò∞</div>
    </div>
  </header>

  <section class="hero" aria-labelledby="heroTitle">
    <h1 id="heroTitle" class="big">All-in-one Professional Media Tools Suite</h1>
    <p class="small">Fast, privacy-first media editing: audio trimming, video conversion, image filters, webcam capture & more. Simple, reliable, and works offline.</p>
    <div class="tabs" role="tablist" aria-label="Media tools tabs">
      <button class="tab active" data-target="audiotrimmer" role="tab">Audio Trimmer</button>
      <button class="tab" data-target="audiospeed" role="tab">Audio Speed</button>
      <button class="tab" data-target="micrecorder" role="tab">Mic Recorder</button>
      <button class="tab" data-target="videotogif" role="tab">Video to GIF</button>
      <button class="tab" data-target="gifcompress" role="tab">GIF Compress</button>
      <button class="tab" data-target="svgtopng" role="tab">SVG to PNG</button>
      <button class="tab" data-target="photosketch" role="tab">Sketch Filter</button>
      <button class="tab" data-target="bgremove" role="tab">Remove Background</button>
      <button class="tab" data-target="imagesharpen" role="tab">Sharpen Image</button>
      <button class="tab" data-target="webcam" role="tab">Webcam Snap</button>
    </div>
  </section>

  <main id="main-content" class="grid">
    <div>
      <section id="audiotrimmer" class="card">
        <h2>Audio Trimmer</h2>
        <div class="hint">Trim audio files directly in your browser. No uploads required.</div>
        <input type="file" id="trimAudioFile" accept="audio/*" onchange="loadAudioForTrim(event)" />
        <audio id="trimAudioPlayer" controls style="width:100%;margin-top:12px;"></audio>
        <div class="row" style="margin-top:12px;">
          <input type="number" id="trimStart" placeholder="Start (seconds)" min="0" step="0.1" />
          <input type="number" id="trimEnd" placeholder="End (seconds)" min="0" step="0.1" />
        </div>
        <button class="primary" onclick="trimAudio()" style="margin-top:12px;">Trim Audio</button>
        <a id="trimDownload" class="btn" style="display:none;margin-top:12px;">Download Trimmed Audio</a>
        <div id="trimRes" class="result"></div>
      </section>

      <section id="audiospeed" class="card" hidden>
        <h2>Audio Speed Changer</h2>
        <div class="hint">Change playback speed without affecting pitch. Browser-only processing.</div>
        <input type="file" id="speedAudioFile" accept="audio/*" onchange="loadAudioForSpeed(event)" />
        <audio id="speedAudioPlayer" controls style="width:100%;margin-top:12px;"></audio>
        <div style="margin-top:12px;">
          <label>Speed: <span id="speedValue">1.0</span>x</label>
          <input type="range" id="speedSlider" min="0.5" max="3" step="0.1" value="1" oninput="changeSpeed(this.value)" />
        </div>
        <div id="speedRes" class="result"></div>
      </section>

      <section id="micrecorder" class="card" hidden>
        <h2>Microphone Recorder</h2>
        <div class="hint">Record audio from your microphone. No data leaves your device.</div>
        <button class="primary" id="micRecordBtn" onclick="toggleMicRecording()">Start Recording</button>
        <audio id="micPlayback" controls style="width:100%;margin-top:12px;display:none;"></audio>
        <a id="micDownload" class="btn" style="display:none;margin-top:12px;">Download Recording</a>
        <div id="micRes" class="result"></div>
      </section>

      <section id="videotogif" class="card" hidden>
        <h2>Video to GIF Converter</h2>
        <div class="hint">Convert video clips to GIF format. Client-side processing.</div>
        <input type="file" id="videoFile" accept="video/*" onchange="loadVideo(event)" />
        <video id="videoPlayer" controls style="width:100%;margin-top:12px;"></video>
        <div class="row" style="margin-top:12px;">
          <input type="number" id="gifStart" placeholder="Start (seconds)" min="0" />
          <input type="number" id="gifDuration" placeholder="Duration (seconds)" min="1" max="10" value="3" />
        </div>
        <button class="primary" onclick="convertToGif()" style="margin-top:12px;">Convert to GIF</button>
        <canvas id="gifCanvas" style="display:none;"></canvas>
        <img id="gifOutput" class="canvas-preview" style="display:none;" />
        <a id="gifDownload" class="btn" style="display:none;margin-top:12px;">Download GIF</a>
        <div id="gifRes" class="result"></div>
      </section>

      <section id="gifcompress" class="card" hidden>
        <h2>GIF Compressor</h2>
        <div class="hint">Reduce GIF file size by adjusting quality and dimensions.</div>
        <input type="file" id="compressGifFile" accept="image/gif" onchange="loadGifForCompress(event)" />
        <img id="compressGifPreview" class="canvas-preview" style="display:none;" />
        <div style="margin-top:12px;">
          <label>Quality: <span id="qualityValue">0.8</span></label>
          <input type="range" id="qualitySlider" min="0.1" max="1" step="0.1" value="0.8" oninput="updateQuality(this.value)" />
        </div>
        <div class="row" style="margin-top:12px;">
          <input type="number" id="gifWidth" placeholder="Width (px)" min="1" />
          <input type="number" id="gifHeight" placeholder="Height (px)" min="1" />
        </div>
        <button class="primary" onclick="compressGif()" style="margin-top:12px;">Compress GIF</button>
        <a id="compressedGifDownload" class="btn" style="display:none;margin-top:12px;">Download Compressed GIF</a>
        <div id="compressRes" class="result"></div>
      </section>

      <section id="svgtopng" class="card" hidden>
        <h2>SVG to PNG Converter</h2>
        <div class="hint">Convert SVG images to PNG format. Works offline in your browser.</div>
        <input type="file" id="svgFile" accept="image/svg+xml" onchange="loadSvg(event)" />
        <textarea id="svgInput" placeholder="Or paste SVG code here..." style="margin-top:12px;min-height:120px;"></textarea>
        <div class="row" style="margin-top:12px;">
          <input type="number" id="pngWidth" placeholder="Width (px)" min="1" value="512" />
          <input type="number" id="pngHeight" placeholder="Height (px)" min="1" value="512" />
        </div>
        <button class="primary" onclick="convertSvgToPng()" style="margin-top:12px;">Convert to PNG</button>
        <img id="pngOutput" class="canvas-preview" style="display:none;" />
        <a id="pngDownload" class="btn" style="display:none;margin-top:12px;">Download PNG</a>
        <div id="svgRes" class="result"></div>
      </section>

      <section id="photosketch" class="card" hidden>
        <h2>Photo Sketch Filter</h2>
        <div class="hint">Apply artistic sketch effect to your photos. Pure client-side processing.</div>
        <input type="file" id="sketchFile" accept="image/*" onchange="applySketchFilter(event)" />
        <canvas id="sketchCanvas" class="canvas-preview" style="display:none;"></canvas>
        <img id="sketchOutput" class="canvas-preview" style="display:none;" />
        <a id="sketchDownload" class="btn" style="display:none;margin-top:12px;">Download Sketch</a>
        <div id="sketchRes" class="result"></div>
      </section>

      <section id="bgremove" class="card" hidden>
        <h2>Remove Image Background</h2>
        <div class="hint">Simple threshold-based background removal. Works best with high contrast.</div>
        <input type="file" id="bgFile" accept="image/*" onchange="removeBackground(event)" />
        <div style="margin-top:12px;">
          <label>Threshold: <span id="thresholdValue">128</span></label>
          <input type="range" id="thresholdSlider" min="0" max="255" value="128" oninput="updateThreshold(this.value)" />
        </div>
        <canvas id="bgCanvas" class="canvas-preview" style="display:none;"></canvas>
        <img id="bgOutput" class="canvas-preview" style="display:none;" />
        <a id="bgDownload" class="btn" style="display:none;margin-top:12px;">Download Image</a>
        <div id="bgRes" class="result"></div>
      </section>

      <section id="imagesharpen" class="card" hidden>
        <h2>Image Sharpen Tool</h2>
        <div class="hint">Enhance image clarity with sharpen filter. Browser-based processing.</div>
        <input type="file" id="sharpenFile" accept="image/*" onchange="sharpenImage(event)" />
        <div style="margin-top:12px;">
          <label>Intensity: <span id="sharpenValue">1.0</span></label>
          <input type="range" id="sharpenSlider" min="0" max="5" step="0.1" value="1" oninput="updateSharpen(this.value)" />
        </div>
        <canvas id="sharpenCanvas" class="canvas-preview" style="display:none;"></canvas>
        <img id="sharpenOutput" class="canvas-preview" style="display:none;" />
        <a id="sharpenDownload" class="btn" style="display:none;margin-top:12px;">Download Sharpened Image</a>
        <div id="sharpenRes" class="result"></div>
      </section>

      <section id="webcam" class="card" hidden>
        <h2>Webcam Snapshot Tool</h2>
        <div class="hint">Take photos directly from your webcam. Privacy-first, no server uploads.</div>
        <video id="webcamVideo" autoplay style="width:100%;margin-top:12px;"></video>
        <button class="primary" id="webcamStartBtn" onclick="toggleWebcam()" style="margin-top:12px;">Start Webcam</button>
        <button class="ghost" id="webcamSnapBtn" onclick="snapPhoto()" style="margin-top:12px;display:none;">Take Snapshot</button>
        <canvas id="webcamCanvas" class="canvas-preview" style="display:none;"></canvas>
        <img id="webcamOutput" class="canvas-preview" style="display:none;" />
        <a id="webcamDownload" class="btn" style="display:none;margin-top:12px;">Download Photo</a>
        <div id="webcamRes" class="result"></div>
      </section>
    </div>

    <aside>
      <div class="feature-panel">
        <div class="panel-title">Why PirateRuler tools?</div>
        <div class="features">
          <div class="feature">
            <div class="f-icon">‚ö°</div>
            <div>
              <div class="f-title">Lightning fast</div>
              <div class="f-desc">Optimized code, minimal dependencies ‚Äî instant media processing on any device.</div>
            </div>
          </div>
          <div class="feature">
            <div class="f-icon">üîí</div>
            <div>
              <div class="f-title">Private by design</div>
              <div class="f-desc">All processing happens in your browser. Your media never leaves your device.</div>
            </div>
          </div>
          <div class="feature">
            <div class="f-icon">üß∞</div>
            <div>
              <div class="f-title">10+ Tools in one</div>
              <div class="f-desc">Audio editing, video conversion, image filters, webcam capture & more media tools.</div>
            </div>
          </div>
          <div class="feature">
            <div class="f-icon">üéØ</div>
            <div>
              <div class="f-title">Accuracy first</div>
              <div class="f-desc">Professional-grade media processing with precise controls.</div>
            </div>
          </div>
          <div class="feature">
            <div class="f-icon">üåê</div>
            <div>
              <div class="f-title">Backup resources</div>
              <div class="f-desc">If this site is offline, visit PirateRuler.com for backups & resources.</div>
            </div>
          </div>
          <div class="feature">
            <div class="f-icon">üì±</div>
            <div>
              <div class="f-title">Mobile-first</div>
              <div class="f-desc">Works perfectly on phones and adapts cleanly to desktops. Full offline support.</div>
            </div>
          </div>
          <div class="feature">
            <div class="f-icon">üíæ</div>
            <div>
              <div class="f-title">Direct downloads</div>
              <div class="f-desc">Save your edited media directly to your device. No watermarks or restrictions.</div>
            </div>
          </div>
          <div class="feature">
            <div class="f-icon">‚å®Ô∏è</div>
            <div>
              <div class="f-title">Keyboard shortcuts</div>
              <div class="f-desc">Full keyboard support for power users. Press ? for help.</div>
            </div>
          </div>
        </div>
        
        <div class="useful-tips">
          <h3>üí° Pro Tips</h3>
          <ul>
            <li><strong>Audio Trimmer:</strong> Use precise start/end times for perfect cuts</li>
            <li><strong>Speed Changer:</strong> 1.5x speed is perfect for podcasts, 0.75x for transcription</li>
            <li><strong>Mic Recorder:</strong> Grant microphone permission when prompted</li>
            <li><strong>Video to GIF:</strong> Keep duration under 5 seconds for smaller files</li>
            <li><strong>GIF Compress:</strong> Reduce dimensions first, then adjust quality</li>
            <li><strong>SVG to PNG:</strong> Increase dimensions for higher resolution output</li>
            <li><strong>Sketch Filter:</strong> Best results with high-contrast photos</li>
            <li><strong>Background Removal:</strong> Adjust threshold for clean separation</li>
            <li><strong>Webcam:</strong> Ensure good lighting for better snapshots</li>
            <li><strong>Offline:</strong> All tools work without internet connection</li>
          </ul>
        </div>
        
        <div class="spacer"></div>
        <div class="feature" style="min-height:unset;align-items:flex-start;padding:14px">
          <div class="f-icon">PR</div>
          <div>
            <div class="f-title">Media Tools By PirateRuler.com</div>
            <div class="f-desc" style="margin-top:6px;display:flex;gap:10px;flex-wrap:wrap;">
              <a class="btn" href="https://pirateruler.com/post/about.html" target="_blank" rel="noopener">About ‚Äî PirateRuler</a>
              <a class="btn" href="https://pirateruler.com/post/privacy.html" target="_blank" rel="noopener">Privacy Policy</a>
              <a class="btn" href="https://pirateruler.com/post/contact.html" target="_blank" rel="noopener">Contact</a>
              <a class="btn" href="https://pirateruler.com/post/terms.html" target="_blank" rel="noopener">Terms & Service</a>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <footer>
    <a class="visit" href="https://pirateruler.com" target="_blank" rel="noopener">Visit PirateRuler.com</a>
    <div style="height:12px"></div>
    <small class="muted">¬© <span id="year"></span> Media Tools By PirateRuler.com ‚Äî Backup & resources: pirateruler.com | <span id="pwa-status"></span></small>
  </footer>
</div>

<aside id="sidebar" class="sidebar" role="dialog">
  <div class="close"><button class="ghost" id="closeSidebar">Close ‚úï</button></div>
  <h3>PirateRuler Links</h3>
  <p class="muted">Quick links & backup resources</p>
  <nav class="nav-list">
    <a href="https://pirateruler.com/post/about.html" target="_blank" rel="noopener">About ‚Äî PirateRuler</a>
    <a href="https://pirateruler.com/post/privacy.html" target="_blank" rel="noopener">Privacy Policy</a>
    <a href="https://pirateruler.com/post/contact.html" target="_blank" rel="noopener">Contact</a>
    <a href="https://pirateruler.com/post/terms.html" target="_blank" rel="noopener">Terms & Service</a>
  </nav>
  <div class="backup">
    If this site is offline you can visit PirateRuler for backups & resources:<br><a href="https://pirateruler.com" target="_blank">pirateruler.com</a>
  </div>
</aside>

<div id="toast" class="toast" role="status"></div>

<script>
  // Year & PWA Status
  document.getElementById('year').textContent = new Date().getFullYear();
  if('serviceWorker' in navigator) document.getElementById('pwa-status').textContent = 'PWA Ready';

  // Theme Toggle
  const themeToggle = document.getElementById('themeBtn');
  const themeThumb = themeToggle.querySelector('.theme-slider-thumb');
  function toggleTheme() {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    themeToggle.classList.toggle('active', isDark);
    themeThumb.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    document.querySelector('meta[name="theme-color"]').setAttribute('content', isDark ? '#1f2937' : '#ffffff');
  }
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') { document.documentElement.classList.add('dark'); themeToggle.classList.add('active'); themeThumb.textContent = '‚òÄÔ∏è'; }
  themeToggle.addEventListener('click', toggleTheme);

  // Sidebar
  const sidebar = document.getElementById('sidebar');
  const hambBtn = document.getElementById('hambBtn');
  const closeSidebar = document.getElementById('closeSidebar');
  function openSidebar(){ sidebar.classList.add('open'); sidebar.setAttribute('aria-hidden','false'); closeSidebar.focus(); }
  function closeSB(){ sidebar.classList.remove('open'); sidebar.setAttribute('aria-hidden','true'); }
  hambBtn.addEventListener('click', openSidebar);
  closeSidebar.addEventListener('click', closeSB);
  document.addEventListener('keydown', e => { if(e.key === 'Escape') closeSB(); });
  document.addEventListener('click', e => { if(sidebar.classList.contains('open') && !sidebar.contains(e.target) && !hambBtn.contains(e.target)) closeSB(); });

  // Tabs
  const tabs = Array.from(document.querySelectorAll('.tab'));
  function showTab(id){
    document.querySelectorAll('main section.card').forEach(s => s.hidden = true);
    const el = document.getElementById(id);
    if(el) { el.hidden = false; el.style.animation = 'none'; el.offsetHeight; el.style.animation = 'cardIn .42s both'; }
    tabs.forEach(t => { const isActive = t.dataset.target === id; t.classList.toggle('active', isActive); t.setAttribute('aria-selected', isActive); });
    history.replaceState(null, null, `#${id}`);
    if(el) el.querySelector('h2').focus();
  }
  tabs.forEach(t => t.addEventListener('click', ()=> showTab(t.dataset.target)));
  const hash = window.location.hash.substring(1);
  if(hash && document.getElementById(hash)) showTab(hash); else showTab('audiotrimmer');

  // Toast
  function showToast(message, icon = '‚ÑπÔ∏è') {
    const toast = document.getElementById('toast');
    toast.innerHTML = `<span class="icon">${icon}</span><span>${message}</span>`;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
  }

  // Utility Functions
  function setText(id,val,type=''){ 
    const el=document.getElementById(id); 
    if(el) { el.textContent = val; el.className = 'result ' + type; }
  }

  // Audio Trimmer
  let trimAudioContext, trimAudioBuffer;
  function loadAudioForTrim(event) {
    const file = event.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      trimAudioContext = new (window.AudioContext || window.webkitAudioContext)();
      trimAudioContext.decodeAudioData(e.target.result, function(buffer) {
        trimAudioBuffer = buffer;
        document.getElementById('trimAudioPlayer').src = URL.createObjectURL(file);
        setText('trimRes','Audio loaded. Set trim points.', 'success');
      });
    };
    reader.readAsArrayBuffer(file);
  }
  function trimAudio() {
    if(!trimAudioBuffer) return setText('trimRes','Load audio first', 'warning');
    const start = parseFloat(document.getElementById('trimStart').value) || 0;
    const end = parseFloat(document.getElementById('trimEnd').value) || trimAudioBuffer.duration;
    if(start >= end || end > trimAudioBuffer.duration) return setText('trimRes','Invalid trim range', 'error');
    
    const sampleRate = trimAudioBuffer.sampleRate;
    const startOffset = Math.floor(start * sampleRate);
    const endOffset = Math.floor(end * sampleRate);
    const trimmedLength = endOffset - startOffset;
    
    const trimmedBuffer = trimAudioContext.createBuffer(trimAudioBuffer.numberOfChannels, trimmedLength, sampleRate);
    for(let channel = 0; channel < trimAudioBuffer.numberOfChannels; channel++) {
      const originalData = trimAudioBuffer.getChannelData(channel);
      const trimmedData = trimmedBuffer.getChannelData(channel);
      for(let i = 0; i < trimmedLength; i++) {
        trimmedData[i] = originalData[startOffset + i];
      }
    }
    
    const wav = audioBufferToWav(trimmedBuffer);
    const blob = new Blob([wav], {type: 'audio/wav'});
    const url = URL.createObjectURL(blob);
    document.getElementById('trimDownload').href = url;
    document.getElementById('trimDownload').style.display = 'inline-block';
    setText('trimRes','Audio trimmed successfully', 'success');
  }

  // Audio Speed Changer
  let speedAudio;
  function loadAudioForSpeed(event) {
    const file = event.target.files[0];
    if(!file) return;
    speedAudio = document.getElementById('speedAudioPlayer');
    speedAudio.src = URL.createObjectURL(file);
    setText('speedRes','Audio loaded. Adjust speed slider.', 'success');
  }
  function changeSpeed(value) {
    document.getElementById('speedValue').textContent = value;
    if(speedAudio) {
      speedAudio.playbackRate = parseFloat(value);
      setText('speedRes',`Speed set to ${value}x`, 'success');
    }
  }

  // Microphone Recorder
  let mediaRecorder, micChunks = [];
  async function toggleMicRecording() {
    const btn = document.getElementById('micRecordBtn');
    if(mediaRecorder && mediaRecorder.state === 'recording') {
      mediaRecorder.stop();
      btn.textContent = 'Start Recording';
      showToast('Recording stopped', '‚èπÔ∏è');
    } else {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({audio: true});
        mediaRecorder = new MediaRecorder(stream);
        micChunks = [];
        mediaRecorder.ondataavailable = e => micChunks.push(e.data);
        mediaRecorder.onstop = () => {
          const blob = new Blob(micChunks, {type: 'audio/webm'});
          const url = URL.createObjectURL(blob);
          document.getElementById('micPlayback').src = url;
          document.getElementById('micPlayback').style.display = 'block';
          document.getElementById('micDownload').href = url;
          document.getElementById('micDownload').download = `recording-${Date.now()}.webm`;
          document.getElementById('micDownload').style.display = 'inline-block';
          stream.getTracks().forEach(track => track.stop());
        };
        mediaRecorder.start();
        btn.textContent = 'Stop Recording';
        showToast('Recording started', 'üî¥');
      } catch(e) {
        setText('micRes','Microphone access denied', 'error');
      }
    }
  }

  // Video to GIF
  let videoElement, gifCanvas, gifCtx;
  function loadVideo(event) {
    const file = event.target.files[0];
    if(!file) return;
    videoElement = document.getElementById('videoPlayer');
    videoElement.src = URL.createObjectURL(file);
    gifCanvas = document.getElementById('gifCanvas');
    gifCtx = gifCanvas.getContext('2d');
    setText('gifRes','Video loaded. Set conversion parameters.', 'success');
  }
  function convertToGif() {
    if(!videoElement) return setText('gifRes','Load video first', 'warning');
    const start = parseFloat(document.getElementById('gifStart').value) || 0;
    const duration = parseFloat(document.getElementById('gifDuration').value) || 3;
    
    videoElement.currentTime = start;
    const frames = [];
    const captureInterval = 100; // Capture every 100ms
    
    const captureFrame = () => {
      if(videoElement.currentTime >= start + duration) {
        createGif(frames);
        return;
      }
      gifCanvas.width = videoElement.videoWidth || 320;
      gifCanvas.height = videoElement.videoHeight || 240;
      gifCtx.drawImage(videoElement, 0, 0);
      frames.push(gifCanvas.toDataURL('image/png'));
      setTimeout(() => {
        videoElement.currentTime += 0.1;
        captureFrame();
      }, captureInterval);
    };
    
    videoElement.onseeked = () => {
      videoElement.onseeked = null;
      captureFrame();
    };
  }
  function createGif(frames) {
    // Simplified GIF creation - in practice, use a library like gif.js
    const canvas = document.getElementById('gifCanvas');
    const img = document.getElementById('gifOutput');
    img.src = frames[0];
    img.style.display = 'block';
    document.getElementById('gifDownload').href = frames[0];
    document.getElementById('gifDownload').style.display = 'inline-block';
    setText('gifRes','GIF created (simplified preview)', 'success');
  }

  // GIF Compressor
  function loadGifForCompress(event) {
    const file = event.target.files[0];
    if(!file) return;
    const img = document.getElementById('compressGifPreview');
    img.src = URL.createObjectURL(file);
    img.style.display = 'block';
    setText('compressRes','GIF loaded. Adjust settings and compress.', 'success');
  }
  function updateQuality(value) {
    document.getElementById('qualityValue').textContent = value;
  }
  function compressGif() {
    const file = document.getElementById('compressGifFile').files[0];
    if(!file) return setText('compressRes','Load GIF first', 'warning');
    const quality = parseFloat(document.getElementById('qualitySlider').value);
    const width = document.getElementById('gifWidth').value;
    const height = document.getElementById('gifHeight').value;
    
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = document.getElementById('compressGifPreview');
    
    canvas.width = width ? parseInt(width) : img.naturalWidth;
    canvas.height = height ? parseInt(height) : img.naturalHeight;
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      document.getElementById('compressedGifDownload').href = url;
      document.getElementById('compressedGifDownload').download = `compressed-${file.name}`;
      document.getElementById('compressedGifDownload').style.display = 'inline-block';
      setText('compressRes',`GIF compressed. Original: ${(file.size/1024).toFixed(2)}KB, New: ${(blob.size/1024).toFixed(2)}KB`, 'success');
    }, 'image/gif', quality);
  }

  // SVG to PNG
  let svgImage;
  function loadSvg(event) {
    const file = event.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('svgInput').value = e.target.result;
      setText('svgRes','SVG loaded. You can edit the code before converting.', 'success');
    };
    reader.readAsText(file);
  }
  function convertSvgToPng() {
    const svgCode = document.getElementById('svgInput').value;
    if(!svgCode) return setText('svgRes','Load or paste SVG first', 'warning');
    
    const width = parseInt(document.getElementById('pngWidth').value) || 512;
    const height = parseInt(document.getElementById('pngHeight').value) || 512;
    
    svgImage = new Image();
    svgImage.onload = function() {
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(svgImage, 0, 0, width, height);
      
      canvas.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        document.getElementById('pngOutput').src = url;
        document.getElementById('pngOutput').style.display = 'block';
        document.getElementById('pngDownload').href = url;
        document.getElementById('pngDownload').download = `converted-${Date.now()}.png`;
        document.getElementById('pngDownload').style.display = 'inline-block';
        setText('svgRes','SVG converted to PNG', 'success');
      });
    };
    svgImage.src = 'data:image/svg+xml;base64,' + btoa(svgCode);
  }

  // Photo Sketch Filter
  function applySketchFilter(event) {
    const file = event.target.files[0];
    if(!file) return;
    const img = new Image();
    img.onload = function() {
      const canvas = document.getElementById('sketchCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      
      for(let i = 0; i < data.length; i += 4) {
        const gray = data[i] * 0.299 + data[i+1] * 0.587 + data[i+2] * 0.114;
        data[i] = gray;
        data[i+1] = gray;
        data[i+2] = gray;
      }
      
      ctx.putImageData(imageData, 0, 0);
      ctx.globalCompositeOperation = 'difference';
      ctx.drawImage(canvas, 1, 1);
      ctx.globalCompositeOperation = 'source-over';
      
      document.getElementById('sketchCanvas').style.display = 'block';
      document.getElementById('sketchDownload').href = canvas.toDataURL();
      document.getElementById('sketchDownload').style.display = 'inline-block';
      setText('sketchRes','Sketch filter applied', 'success');
    };
    img.src = URL.createObjectURL(file);
  }

  // Background Remove
  let bgImage;
  function removeBackground(event) {
    const file = event.target.files[0];
    if(!file) return;
    bgImage = new Image();
    bgImage.onload = function() {
      const canvas = document.getElementById('bgCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = bgImage.width;
      canvas.height = bgImage.height;
      ctx.drawImage(bgImage, 0, 0);
      
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      const threshold = parseInt(document.getElementById('thresholdSlider').value);
      
      for(let i = 0; i < data.length; i += 4) {
        const brightness = (data[i] + data[i+1] + data[i+2]) / 3;
        if(brightness > threshold) {
          data[i+3] = 0; // Make pixel transparent
        }
      }
      
      ctx.putImageData(imageData, 0, 0);
      document.getElementById('bgCanvas').style.display = 'block';
      document.getElementById('bgDownload').href = canvas.toDataURL();
      document.getElementById('bgDownload').style.display = 'inline-block';
      setText('bgRes','Background removed (threshold filter)', 'success');
    };
    bgImage.src = URL.createObjectURL(file);
  }
  function updateThreshold(value) {
    document.getElementById('thresholdValue').textContent = value;
    if(bgImage) removeBackground({target: {files: [document.getElementById('bgFile').files[0]]}});
  }

  // Image Sharpen
  let sharpenImage;
  function sharpenImage(event) {
    const file = event.target.files[0];
    if(!file) return;
    sharpenImage = new Image();
    sharpenImage.onload = function() {
      const canvas = document.getElementById('sharpenCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = sharpenImage.width;
      canvas.height = sharpenImage.height;
      ctx.drawImage(sharpenImage, 0, 0);
      
      const intensity = parseFloat(document.getElementById('sharpenSlider').value);
      ctx.filter = `contrast(${100 + intensity * 20}%)`;
      ctx.drawImage(canvas, 0, 0);
      
      document.getElementById('sharpenCanvas').style.display = 'block';
      document.getElementById('sharpenDownload').href = canvas.toDataURL();
      document.getElementById('sharpenDownload').style.display = 'inline-block';
      setText('sharpenRes','Sharpen filter applied', 'success');
    };
    sharpenImage.src = URL.createObjectURL(file);
  }
  function updateSharpen(value) {
    document.getElementById('sharpenValue').textContent = value;
    if(sharpenImage) sharpenImage({target: {files: [document.getElementById('sharpenFile').files[0]]}});
  }

  // Webcam Snapshot
  let webcamStream;
  async function toggleWebcam() {
    const video = document.getElementById('webcamVideo');
    const btn = document.getElementById('webcamStartBtn');
    if(webcamStream) {
      webcamStream.getTracks().forEach(track => track.stop());
      webcamStream = null;
      video.style.display = 'none';
      btn.textContent = 'Start Webcam';
      document.getElementById('webcamSnapBtn').style.display = 'none';
      showToast('Webcam stopped', '‚èπÔ∏è');
    } else {
      try {
        webcamStream = await navigator.mediaDevices.getUserMedia({video: true});
        video.srcObject = webcamStream;
        video.style.display = 'block';
        btn.textContent = 'Stop Webcam';
        document.getElementById('webcamSnapBtn').style.display = 'inline-block';
        showToast('Webcam started', 'üìπ');
      } catch(e) {
        setText('webcamRes','Camera access denied', 'error');
      }
    }
  }
  function snapPhoto() {
    const video = document.getElementById('webcamVideo');
    const canvas = document.getElementById('webcamCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);
    
    const img = document.getElementById('webcamOutput');
    img.src = canvas.toDataURL();
    img.style.display = 'block';
    document.getElementById('webcamDownload').href = canvas.toDataURL();
    document.getElementById('webcamDownload').download = `webcam-snapshot-${Date.now()}.png`;
    document.getElementById('webcamDownload').style.display = 'inline-block';
    showToast('Photo captured', 'üì∏');
  }

  // Helper: AudioBuffer to WAV
  function audioBufferToWav(buffer) {
    const length = buffer.length * buffer.numberOfChannels * 2 + 44;
    const arrayBuffer = new ArrayBuffer(length);
    const view = new DataView(arrayBuffer);
    const channels = [];
    let offset = 0;
    let pos = 0;

    function setUint16(data) {
      view.setUint16(pos, data, true);
      pos += 2;
    }

    function setUint32(data) {
      view.setUint32(pos, data, true);
      pos += 4;
    }

    // RIFF identifier
    setUint32(0x46464952);
    // file length
    setUint32(length - 8);
    // RIFF type
    setUint32(0x45564157);
    // format chunk identifier
    setUint32(0x20746d66);
    // length of format chunk
    setUint32(16);
    // sample format (raw)
    setUint16(1);
    // channel count
    setUint16(buffer.numberOfChannels);
    // sample rate
    setUint32(buffer.sampleRate);
    // byte rate
    setUint32(buffer.sampleRate * 2 * buffer.numberOfChannels);
    // block align
    setUint16(buffer.numberOfChannels * 2);
    // bits per sample
    setUint16(16);
    // data chunk identifier
    setUint32(0x61746164);
    // length of data chunk
    setUint32(length - pos - 4);

    // Write interleaved data
    for(let i = 0; i < buffer.numberOfChannels; i++) {
      channels.push(buffer.getChannelData(i));
    }

    while(pos < length) {
      for(let i = 0; i < buffer.numberOfChannels; i++) {
        let sample = Math.max(-1, Math.min(1, channels[i][offset]));
        sample = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
        view.setInt16(pos, sample, true);
        pos += 2;
      }
      offset++;
    }

    return arrayBuffer;
  }

  // Keyboard shortcuts
  document.addEventListener('keydown', e => {
    if(e.ctrlKey && e.key === 's') { 
      e.preventDefault(); 
      const active = document.querySelector('section.card:not([hidden])'); 
      if(active.id === 'notes') saveNotes(); 
    }
    if(e.ctrlKey && e.key === 'p') { 
      e.preventDefault(); 
      window.print(); 
    }
    if(e.key === '?' && !e.ctrlKey) { 
      e.preventDefault(); 
      showToast('Shortcuts: Ctrl+S=Save, Ctrl+P=Print, ?=Help', '‚å®Ô∏è'); 
    }
  });
</script>
</body>
</html>
